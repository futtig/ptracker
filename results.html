<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dee's Poker Tracker – Results</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #2c3e50;
      color: #ecf0f1;
    }
    h1 {
      background-color: #1abc9c;
      color: #fff;
      padding: 20px;
      text-align: center;
      margin: 0;
      font-size: 28px;
      text-shadow: 1px 1px 2px #000;
    }
    #resultsContainer {
      max-width: 1200px;
      margin: 20px auto;
      background: #34495e;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    table th, table td {
      border: 1px solid #7f8c8d;
      padding: 10px;
      text-align: center;
    }
    table th {
      background-color: #1abc9c;
      color: white;
    }
    .profit {
      color: #2ecc71;
      font-weight: bold;
    }
    .loss {
      color: #e74c3c;
      font-weight: bold;
    }
    #chartContainer {
      margin: 20px 0;
      background: #34495e;
      border-radius: 8px;
      padding: 10px;
    }
    canvas {
      max-width: 100%;
      height: auto;
    }
  </style>
</head>
<body>

<h1>Dee's Poker Tracker – Results</h1>

<div id="resultsContainer">
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Start Time</th>
        <th>End Time</th>
        <th>Tables</th>
        <th>Hands Played</th>
        <th>Stakes</th>
        <th>Profit/Loss</th>
        <th>Total Profit/Loss</th>
      </tr>
    </thead>
    <tbody id="resultsTableBody">
      <!-- Data from the tracker will be dynamically injected here -->
    </tbody>
  </table>

  <div id="chartContainer">
    <canvas id="resultsChart"></canvas>
  </div>
</div>

<script>
  // Fetch the latest data from localStorage
  function loadResults() {
    try {
      const resultsData = JSON.parse(localStorage.getItem('pokerResults')) || [];
      
      if (!Array.isArray(resultsData)) {
        console.error("Invalid data format in localStorage. Expected an array.");
        return; // Exit if data is invalid
      }

      const tableBody = document.getElementById('resultsTableBody');
      const cumulativeProfits = [];
      const totalHands = [];

      let cumulativeProfit = 0;

      // Clear the table to ensure no duplication
      tableBody.innerHTML = '';

      // Populate table and prepare data for the chart
      resultsData.forEach((session) => {
        const row = document.createElement('tr');
        
        // Parse profit/loss and calculate cumulative profit
        const sessionProfit = parseFloat(session.profit || "0");
        cumulativeProfit += sessionProfit;

        // Add cumulative profit to chart data
        cumulativeProfits.push(cumulativeProfit);
        totalHands.push(parseInt(session.hands || "0"));

        row.innerHTML = `
          <td>${session.date || "N/A"}</td>
          <td>${session.startTime || "N/A"}</td>
          <td>${session.endTime || "N/A"}</td>
          <td>${session.tables || "N/A"}</td>
          <td>${session.hands || "N/A"}</td>
          <td>${session.stakes || "N/A"}</td>
          <td class="${sessionProfit >= 0 ? 'profit' : 'loss'}">$${sessionProfit.toFixed(2)}</td>
          <td class="${cumulativeProfit >= 0 ? 'profit' : 'loss'}">$${cumulativeProfit.toFixed(2)}</td>
        `;
        
        tableBody.appendChild(row);
      });

      // Create the cumulative profit chart
      const ctx = document.getElementById('resultsChart').getContext('2d');
      
	  // Destroy existing chart instance if it exists (to avoid duplication)
	  if (window.myChart) window.myChart.destroy();

	  window.myChart = new Chart(ctx, {
		type: 'line',
		data: {
		  labels: totalHands,
		  datasets: [{
			label: 'Cumulative Profit',
			data: cumulativeProfits,
			borderColor: '#2ecc71',
			backgroundColor: 'rgba(46,204,113,0.1)',
			fill: true,
			tension: 0.3
		  }]
		},
		options:
		{
			responsive:true,
		 maintainAspectRatio:false.
			scales:{
			 x:{...

